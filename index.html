<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BananaFit</title>

    <!-- Specify the Favicon -->
    <link rel="icon" href="/Users/akki/Desktop/github main/Cruz-Hacks-Demo-ATALLDAB.github.io/Untitled/icobanana.ico" type="image/x-icon">

    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>

    <style>
        body {
            text-align: center;
            margin: 50px;
            background-color: #000000; /* Black background color */
            color: #ffffff; /* White text color */
        }

        h1 {
            font-size: 3em;
            color: #FFFF00; /* Yellow color */
        }

        #datetime {
            font-size: 1.5em;
            color: #FFFF00; /* Yellow color */
            margin-bottom: 10px;
        }

        #container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        #bar-container {
            display: flex;
            align-items: flex-end;
            margin-bottom: 20px;
            position: relative;
        }

        #static-bar {
            width: 150px;
            height: 400px; /* Set the height of the static bar */
            background-color: #FFFF00; /* Yellow color */
            border: 2px solid #000000; /* Black border */
            margin-right: 20px; /* Margin to separate static bar and input */
            z-index: 1; /* Place static bar behind dynamic bar */
        }

        #dynamic-bar {
            width: 150px;
            height: 400px; /* Increase the height to make the bar longer */
            border: 2px solid #000000; /* Black border */
            background-color: #FF0000; /* Red color of the stagnant dynamic bar */
            position: absolute; /* Position absolute for overlapping */
            z-index: 2; /* Place dynamic bar on top */
        }

        #capacity-input {
            font-size: 1.5em;
            padding: 5px;
        }

        #percentage-display {
            font-size: 1.5em;
            color: #FFFF00; /* Yellow color */
        }

        #camera-feed {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 3; /* Place camera feed on top */
        }
    </style>
</head>
<body>
    <h1>BananaFit</h1>

    <!-- Display current date and time -->
    <div id="datetime"></div>

    <div id="container">
        <!-- Bar and input container -->
        <div id="bar-container">
            <!-- Static bar (changes based on the user input) -->
            <div id="static-bar"></div>

            <!-- Dynamic bar (remains stagnant) -->
            <div id="dynamic-bar"></div>

            <!-- Input for the user to type a number out of 160 -->
            <input type="number" id="capacity-input" placeholder="Enter a number out of 160" oninput="updateDynamicBar()">

            <!-- Display percentage above the input -->
            <div id="percentage-display">Percentage Full: 0.00%</div>

            <!-- Video feed from the camera -->
            <video id="camera-feed" width="300" height="200" autoplay></video>
        </div>
    </div>

    <script>
        // Display current date and time
        function updateDateTime() {
            var currentDate = new Date();
            var formattedDate = currentDate.toLocaleDateString();
            var formattedTime = currentDate.toLocaleTimeString();
            document.getElementById('datetime').innerText = formattedDate + ' ' + formattedTime;
        }

        // Function to update dynamic bar based on the user input
        function updateDynamicBar() {
            var capacityInput = document.getElementById('capacity-input');
            var dynamicBar = document.getElementById('dynamic-bar');
            var percentageDisplay = document.getElementById('percentage-display');
            
            var inputValue = parseInt(capacityInput.value) || 0; // Parse the input value as an integer (default to 0 if not a valid number)
            var yellowPercentage = (inputValue / 160) * 100; // Calculate the yellow percentage

            // Update dynamic bar (remains stagnant)
            dynamicBar.style.height = yellowPercentage * 4 + 'px'; // Adjusted multiplier for a longer bar
            dynamicBar.style.backgroundColor = `rgba(255, 0, 0, ${yellowPercentage / 100})`; // Adjust the color based on the percentage

            percentageDisplay.innerText = `Percentage Full: ${yellowPercentage.toFixed(2)}%`; // Display the percentage above the input
        }

        // Access the camera and display the video feed
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const videoElement = document.getElementById('camera-feed');
                videoElement.srcObject = stream;

                // Set up motion detection
                const motionDetection = new MotionDetection(videoElement, 30, onMotionDetected);

                // Start motion detection
                motionDetection.start();

                // Stop motion detection after 10 seconds (adjust as needed)
                setTimeout(() => {
                    motionDetection.stop();
                }, 10000);
            } catch (error) {
                console.error('Error accessing the camera:', error);
            }
        }

        // Callback function for motion detected
        function onMotionDetected() {
            // Increment the counter or update as needed
            console.log('Motion Detected!');
        }

        // Update date and time every second
        setInterval(updateDateTime, 1000);
        updateDateTime(); // Initial call to set the initial date and time

        // Initialize the dynamic bar display with a default value
        updateDynamicBar();

        // Start the camera and motion detection when the page loads
        document.addEventListener('DOMContentLoaded', startCamera);
    </script>

    <script>
        // Simple motion detection class
        class MotionDetection {
            constructor(videoElement, sensitivity, onMotionDetected) {
                this.videoElement = videoElement;
                this.sensitivity = sensitivity;
                this.onMotionDetected = onMotionDetected;
                this.canvas = document.createElement('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.motionTimer = null;

                this.videoWidth = videoElement.width;
                this.videoHeight = videoElement.height;

                this.canvas.width = this.videoWidth;
                this.canvas.height = this.videoHeight;

                // Capture initial frame as reference
                this.captureReferenceFrame();
            }

            start() {
                this.motionTimer = requestAnimationFrame(this.detectMotion.bind(this));
            }

            stop() {
                cancelAnimationFrame(this.motionTimer);
            }

            captureReferenceFrame() {
                this.ctx.drawImage(this.videoElement, 0, 0, this.videoWidth, this.videoHeight);
                this.referenceFrame = this.ctx.getImageData(0, 0, this.videoWidth, this.videoHeight);
            }

            detectMotion() {
                this.ctx.drawImage(this.videoElement, 0, 0, this.videoWidth, this.videoHeight);
                const currentFrame = this.ctx.getImageData(0, 0, this.videoWidth, this.videoHeight);

                const diffPixels = this.calculatePixelDifference(this.referenceFrame.data, currentFrame.data);
                const diffPercentage = (diffPixels / (this.videoWidth * this.videoHeight)) * 100;

                if (diffPercentage > this.sensitivity) {
                    // Motion detected
                    this.onMotionDetected();
                }

                // Capture the current frame for the next iteration
                this.referenceFrame = currentFrame;

                // Continue motion detection
                this.motionTimer = requestAnimationFrame(this.detectMotion.bind(this));
            }

            calculatePixelDifference(reference, current) {
                let diffPixels = 0;

                for (let i = 0; i < reference.length; i += 4) {
                    const diffR = Math.abs(reference[i] - current[i]);
                    const diffG = Math.abs(reference[i + 1] - current[i + 1]);
                    const diffB = Math.abs(reference[i + 2] - current[i + 2]);

                    // Using a simple grayscale approximation
                    const diff = (diffR + diffG + diffB) / 3;

                    if (diff > 20) {
                        diffPixels++;
                    }
                }

                return diffPixels;
            }
        }
    </script>
</body>
</html>
